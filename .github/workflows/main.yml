name: ЁЯЪА Laravel FTP Deploy

on:
  push:
    branches:
      - main

jobs:
  ftp-deploy:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: рж╕ржарж┐ржХ PHP ржнрж╛рж░рзНрж╕ржи рж╕рзЗржЯ ржХрж░рзБржи
      - name: ЁЯРШ Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'  # Namecheap рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓ржмрзЗ
          tools: composer:v2
          
      # Step 2: рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржЪрзЗржХржЖржЙржЯ
      - name: ЁЯЫТ Checkout Repository
        uses: actions/checkout@v3

      # Step 3: ржХржорзНржкрзЛржЬрж╛рж░ ржбрж┐ржкрзЗржирзНржбрзЗржирзНрж╕рж┐ ржЗржирж╕рзНржЯрж▓
      - name: ЁЯУж Install Composer Dependencies
        run: |
          composer install --no-dev --optimize-autoloader --no-interaction

      # Step 4: рж▓рж╛рж░рж╛ржнрзЗрж▓ рж╕рзЗржЯржЖржк
      - name: ЁЯФз Laravel Setup
        run: |
          cp .env.example .env || true
          php artisan key:generate --force || true

      # Step 5: FTP ржбрзЗржкрзНрж▓рзЯ
      - name: ЁЯУд Deploy to Namecheap FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ftp.stutips.com
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          port: 21
          protocol: ftp
          local-dir: ./
          server-dir: ./public_html/chapaivisa.com/
          exclude: |
            **/.git*
            **/.github*
            **/.env*
            **/node_modules/**
            **/vendor/**
            storage/**
            tests/**
          dry-run: false
