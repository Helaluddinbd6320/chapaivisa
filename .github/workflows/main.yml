name: ЁЯЪА Laravel FTP Deploy

on:
  push:
    branches:
      - main

jobs:
  ftp-deploy:
    runs-on: ubuntu-latest
    
    # Step 1: рж╕ржарж┐ржХ PHP ржнрж╛рж░рзНрж╕ржи рж╕рзЗржЯ ржХрж░рзБржи
    - name: ЁЯРШ Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.4'  # ржЕржержмрж╛ ржЖржкржирж╛рж░ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ ржпрзЗ ржнрж╛рж░рзНрж╕ржи ржЪрж╛ржЗ рж╕рзЗржЯрж╛
        tools: composer:v2
        
    # Step 2: рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржЪрзЗржХржЖржЙржЯ
    - name: ЁЯЫТ Checkout Repository
      uses: actions/checkout@v3

    # Step 3: ржХржорзНржкрзЛржЬрж╛рж░ ржбрж┐ржкрзЗржирзНржбрзЗржирзНрж╕рж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи
    - name: ЁЯУж Install Composer Dependencies
      run: |
        composer install --no-dev --optimize-autoloader --no-interaction
        # ржпржжрж┐ ржПрж░рж░ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржПржЗржЯрж╛ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи:
        # composer update --no-dev --optimize-autoloader --no-interaction

    # Step 4: рж▓рж╛рж░рж╛ржнрзЗрж▓ рж╕рзЗржЯржЖржк ржХрж░рзБржи (ржпржжрж┐ ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯ)
    - name: ЁЯФз Laravel Setup
      run: |
        cp .env.example .env  # рж╢рзБржзрзБ ржпржжрж┐ .env ржирж╛ ржерж╛ржХрзЗ
        php artisan key:generate --force

    # Step 5: FTP рждрзЗ ржбрзЗржкрзНрж▓рзЯ ржХрж░рзБржи
    - name: ЁЯУд Deploy to Namecheap FTP
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ftp.stutips.com
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        port: 21
        protocol: ftp
        local-dir: ./
        server-dir: ./public_html/chapaivisa.com/
        exclude: |
          **/.git*
          **/.github*
          **/.env*
          **/node_modules/**
          **/vendor/**
          storage/**
          tests/**
        dry-run: false  # true ржХрж░рзЗ ржкрзНрж░ржержорзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи
